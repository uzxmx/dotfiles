#!/usr/bin/env bash
#
# Install fd (https://github.com/sharkdp/fd)

set -eo pipefail

export DOTFILES_DIR="${DOTFILES_DIR:-$(cd -- "$(dirname "$0")/../.." &>/dev/null && pwd -P)}"
export DOTFILES_TARGET_DIR="${DOTFILES_TARGET_DIR:-$HOME}"

source "$DOTFILES_DIR/scripts/lib/install.sh"

check_command fd &> /dev/null && exit

if is_mac && [ -z "$DOTFILES_NON_INTRUSIVE_MODE" ]; then
  brew_install fd
else
  version=7.4.0
  install_fn() {
    local dir="$(find "$1" -maxdepth 1 -type d | grep -v '^\.$' | tail -1)"
    cd "$dir"
    if [ -n "$DOTFILES_NON_INTRUSIVE_MODE" ]; then
      cp fd $DOTFILES_TARGET_DIR/bin
    else
      sudo cp fd /usr/local/bin/ && sudo cp fd.1 /usr/local/share/man/man1/ && sudo mandb
    fi
  }
  download_and_install "https://github.com/sharkdp/fd/releases/download/v${version}/fd-v${version}-x86_64-unknown-linux-musl.tar.gz" install_fn
fi
