#!/usr/bin/env bash

set -eo pipefail

export DOTFILES_DIR="${DOTFILES_DIR:-$(cd -- "$(dirname "$0")/.." &>/dev/null && pwd -P)}"
qiniu_dir="$DOTFILES_DIR/scripts/qiniu"

source "$DOTFILES_DIR/scripts/lib/cli.sh"

usage() {
  cat <<-EOF
Utility to manage qiniu resources.

To authenticate, you can export environment variables (QINIU_ACCESS_KEY,
QINIU_SECRET_KEY, QINIU_BUCKET), or pass options.

Subcommands:
  b, bucket - manage buckets
  u, upload - upload files to qiniu
  l, list   - list files
  f, filter - filter listed files
  c, cert   - Manage SSL certificates
  d, domain - Manage domains
EOF
  exit 1
}

case "$1" in
  b | bucket | u | upload | l | list | f | filter | c | cert | d | domain)
    case "$1" in
      b)
        name="bucket"
        ;;
      u)
        name="upload"
        ;;
      l)
        name="list"
        ;;
      f)
        name="filter"
        ;;
      c)
        name="cert"
        ;;
      d)
        name="domain"
        ;;
      *)
        name="$1"
        ;;
    esac
    source "$qiniu_dir/$name.sh"
    run "$@"
    ;;
  *)
    usage
    ;;
esac
